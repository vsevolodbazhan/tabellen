openapi: 3.0.3

info:
  title: Tabellen
  version: 0.1.0
  x-config:
    schema:
      type: object
      properties:
        spreadsheetId:
          type: string
          description: Идентификатор Google Таблицы
        column:
          type: string
          description: Столбец
        rangeStart:
          type: integer
          description: Начало диапазона
        rangeEnd:
          type: integer
          description: Конец диапазона
      required:
        - spreadsheetId
        - column
        - rangeStart
        - rangeEnd

paths:
  /:
    get:
      operationId: tabellen.api.hello
      responses:
        200:
          description: Greeting
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string

  /send-message:
    post:
      operationId: tabellen.api.send_message
      summary: Отправить сообщение
      description: Отправить сообщение клиентам из Google Таблицы
      tags:
        - tomoru/action
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                botId:
                  $ref: "https://api.tomoru.ru/openapi#/components/schemas/botId"
                config:
                  $ref: "https://api.tomoru.ru/openapi#/components/schemas/TomoruConfig"
              required:
                - botId
                - config
      responses:
        200:
          description: Сообщение отправлено
        424:
          description: Не найден вебхук для отправки сообщения

  /subscribe:
    post:
      operationId: tabellen.api.subscribe
      tags:
        - tomoru/subscribe
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                tomoruCallbackUrl:
                  type: string
              required:
                - tomoruCallbackUrl
      callbacks:
        newMessage:
          "{$request.body#/tomoruCallbackUrl}":
            post:
              summary: Новое сообщение
              requestBody:
                content:
                  application/json:
                    schema:
                      $ref: "https://api.tomoru.ru/openapi#/components/schemas/TomoruEvent"
              responses:
                200:
                  description: Все ок
      responses:
        200:
          description: Подписка оформлена
